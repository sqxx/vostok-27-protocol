# Протокол «Восток-27»

## Терминология

*Master* – Устройство, осуществляющее управление *slave*

*Slave* – Устройство, выполняющие команды *master*

## Структура

| \# |  Значение  | Описание                |
|:--:|:----------:|-------------------------|
|  1 |  0x**F4**  | Код начала пакета       |
|  2 |     0x     | Код команды             |
|  3 |     0x     | Данные                  |
|  4 |     0x     | Данные                  |
|  5 |     0x     | Данные                  |
|  6 |     0x     | Данные                  |
|  7 |     0x     | Контрольная сумма       |
|  8 |     0x     | Контрольная сумма       |
|  9 |  0x**0D**  | Код конца пакета (CR)   |
| 10 |  0x**0A**  | Код конца пакета (LF)   |

Порядок байт строго Big-Endian.

Максимальная длина данных: 4 байта.

Контрольная сумма: 2 байта. Вычисляется суммированием со 2 по 6 байта включительно.4

## Реализация ver 1.4

**Состояние станции**

Отправляет только *slave*

| Состояние                              | Код      |
|----------------------------------------|----------|
| Станция запущена                       | 0x**01** |
| Инициализация завершена                | 0x**02** |
| Станция ещё не готова к использованию  | 0x**03** |
| Низкое напряжение на солнечных панелях | 0x**0A** |
| Пониженное давление                    | 0x**0B** |
| Люк открыт                             | 0x**0C** |

**Показатели систем станции**

*Master* отправляет команду с любыми данными, *slave* возвращает показатель с
корректными данными.

| Показатель               | Код      | Единицы измерения | Тип |
|--------------------------|----------|-------------------|-----|
| Уровень углекислого газа | 0x**A1** | ppm               | Int |
| Уровень влажности        | 0x**A2** | %                 | Int |
| Температура воздуха      | 0x**A3** | ℃                 | Int |
| Давление на станции      | 0x**A4** | мБар              | Int |
| Напряжение АКБ           | 0x**A5** | В                 | Int |
| Потребление станции      | 0x**A6** | Вт                | Int |
| Генерация энергии        | 0x**A7** | %                 | Int |

**Управление станцией**

| Запрос                                                      | Код      | Возвращаемое значение             | Принимаемое значение                                |
|-------------------------------------------------------------|----------|-----------------------------------|-----------------------------------------------------|
| Переключить надув станции                                   | 0x**B0** | 0 (Закрыт), FF (Открыт)           | 0 (Закрыт), FF (Открыт) Прочее - инверсия состояния |
| Статус клапана надува станции                               | 0x**B1** | 0 (Закрыт), FF (Открыт)           | \-                                                  |
| Переключить клапан сброса давления                          | 0x**B2** | 0 (Закрыт), FF (Открыт)           | 0 (Закрыт), FF (Открыт) Прочее - инверсия состояния |
| Статус клапана сброса давления                              | 0x**B3** | 0 (Закрыт), FF (Открыт)           | \-                                                  |
| Переключить подсистему выработки CO2                        | 0x**B4** | 0 (Выкл), FF (Вкл)                | 0 (Выкл), FF (Вкл) Прочее - инверсия состояния      |
| Статус подсистемы выработки CO2                             | 0x**B5** | 0 (Выкл), FF (Вкл)                | \-                                                  |
| Переключить подсистему нейтрализации CO2                    | 0x**B6** | 0 (Выкл), FF (Вкл)                | 0 (Выкл), FF (Вкл) Прочее - инверсия состояния      |
| Статус подсистемы нейтрализации CO2                         | 0x**B7** | 0 (Выкл), FF (Вкл)                | \-                                                  |
| Переключить нагрев станции                                  | 0x**B8** | 0 (Выкл), FF (Вкл)                | 0 (Выкл), FF (Вкл) Прочее - инверсия состояния      |
| Статус нагрева станции                                      | 0x**B9** | 0 (Выкл), FF (Вкл)                | \-                                                  |
| Переключить вентилятор                                      | 0x**BA** | 0 (Выкл), FF (Вкл)                | 0 (Выкл), FF (Вкл) Прочее - инверсия состояния      |
| Статус вентилятора                                          | 0x**BB** | 0 (Выкл), FF (Вкл)                | \-                                                  |
| Переключить камеры                                          | 0x**BC** | 0 (Выкл), FF (Вкл)                | 0 (Выкл), FF (Вкл) Прочее - инверсия состояния      |
| Статус камер                                                | 0x**BD** | 0 (Выкл), FF (Вкл)                | \-                                                  |
| Переключить автоматическое управление освещением            | 0x**BE** | 0 (Выкл), FF (Вкл)                | 0 (Выкл), FF (Вкл) Прочее - инверсия состояния      |
| Статус автоматического управления освещением                | 0x**BF** | 0 (Выкл), FF (Вкл)                | \-                                                  |
| Переключить подсистему автоматического поддержания давления | 0x**C1** | 0 (Выкл), FF (Вкл)                | 0 (Выкл), FF (Вкл) Прочее - инверсия состояния      |
| Статус подсистемы автоматического поддержания давления      | 0x**C2** | 0 (Выкл), FF (Вкл)                | \-                                                  |
| Установить время на станции                                 | 0x**D1** | \-                                | Unix timestamp                                      |
| Установить время вечера                                     | 0x**D2** | \-                                | Unix timestamp                                      |
| Установить время дня                                        | 0x**D3** | \-                                | Unix timestamp                                      |
| Установить яркость освещения                                | 0x**D4** | \-                                | 0 – 100 Процент яркости освещения                   |
| Получить текущее время                                      | 0x**DA** | Unix timestamp                    | \-                                                  |
| Получить время утра                                         | 0x**DB** | Unix timestamp                    | \-                                                  |
| Получить время вечера                                       | 0x**DС** | Unix timestamp                    | \-                                                  |
| Получить уровень яркости освещения                          | 0x**DD** | 0 – 100 Процент яркости освещения | \-                                                  |

**Исключения**

Отправляет только *slave*

| Состояние                      | Код      | Значение                                                               |
|--------------------------------|----------|------------------------------------------------------------------------|
| Повреждение переданного пакета | 0x**E1** | 0x**DA** – Несовпадение CRLF 0x**F4** – Несовпадение магического числа |
| Неверная контрольная сумма     | 0x**E2** | **CRC**                                                                |
| Неверная команда               | 0x**E3** | Переданная команда                                                     |
